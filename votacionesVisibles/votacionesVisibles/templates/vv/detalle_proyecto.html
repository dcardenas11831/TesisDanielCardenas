{% extends "vv/base.html" %}

{% block imports%}
{% load staticfiles %}
<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.2/themes/base/jquery-ui.css" type="text/css" media="all" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/highcharts-more.js"></script>
<meta charset="utf-8">

{% endblock %}
{% block title %}Proyecto de ley - Votaciones Visibles{% endblock %}

{% block content %}
    <h1 id="tema_seleccionado">PROYECTO DE LEY</h1>
    <h2 id="proyecto_seleccionado"> {{proyecto.titulo}}</h2>

    <div id="columna_izquierda">
        <p>
            <mark>TEMA PRINCIPAL:</mark> {{proyecto.tema_principal.nombre}}<br><br>
            <mark>RESUMEN:</mark> {{proyecto.sinapsis}}<br><br>
            <mark>ESTADO ACTUAL:</mark> {{proyecto.estado_proyecto_ley_actual.estado.nombre}}<br><br>
            <mark>PALABRAS CLAVE:</mark> {{proyecto.tags}}<br><br>
            <mark>INICIATIVA:</mark> {{proyecto.iniciativa.nombre}}<br><br>
            <mark>TIPO PROYECTO:</mark> {{proyecto.tipo_proyecto.nombre}}<br><br>
            <mark>FECHA RADICACION:</mark> {{proyecto.fecha_radicacion}}<br><br>
        </p>

        <div id="chart_panel"></div>
    </div>
    <div id="columna_derecha">
        <p>Digite el nombre del congresista o partido de su inter&#233;s para ver sus votos en este proyecto</p>
        <div class="ui-widget">
            <input id="busqueda">
            <input type="submit" class="btn-buscar" value="">
        </div>

        <ul>
            {% for votacion in votaciones %}
            <li> {{votacion}}</li>
                <ul>
                    {% for v in votacion %}
                    <li> {{v.motivo}}</li>
                    {% endfor %}
                </ul>
            {% endfor %}
        </ul>
    </div>


    <script type="text/javascript" charset="UTF-8">
			$(function () {

	var partidos = {{ partidos|safe }};

	fijox = 7;
	fijoy = 1.5;
	votos = [];
    for(partido of partidos){
    	votos = partido.data;
    	temps = [];
    	for (v = 0; v < 4; v++) {
    		if(votos[v] > 0){
    			temp = [fijox, fijoy+3*v, votos[v]];
    			temps.push(temp);
    		}
    	}
    	partido.data = temps;
    	fijox += 2;
    }
    partidos.push(
    	{
        	enableMouseTracking: false,
        	color: 'transparent',
        	showInLegend: false,
            data: [[3, 1.5, 0]]
        },{
        	enableMouseTracking: false,
        	color: 'transparent',
        	showInLegend: false,
            data: [[5, 1.5, 0]]
        });

    $('#chart_panel').highcharts({

        chart: {
            type: 'bubble',
            zoomType: 'none',
            style: {
                    fontFamily: 'sans-serif',
            },
        },

        title: {
            text: ''
        },
        tooltip: {
    		formatter: function() {
        		return this.series.name + ': '+this.point.shapeArgs.r+'%';
    		}
		},
        plotOptions: {
            bubble: {
                marker: {
                    lineWidth: 0,
                },
            },
        },
        xAxis: {
            lineWidth: 0,
            minorGridLineWidth: 0,
            lineColor: 'transparent',
            labels: {
                enabled: false
            },
            minorTickLength: 0,
            tickLength: 0,
        },

        yAxis: {
            gridLineWidth: 0,
            lineWidth: 0,
            minorGridLineWidth: 0,
            lineColor: 'transparent',
            labels: {
                enabled: false
            },
            title: {
                text: ''
            },
            minorTickLength: 0,
            tickLength: 1,
            plotLines: [
            {
                color: 'grey', // Color value
                value: 0,
                width: 2, // Width of the line
                label: {
                    text: 'Inasistencias',
                    align: 'left',
                    y: -20,
                    style: {
                        color: 'grey',
                        fontWeight: 'bold',
                    },
                },
            },
            {
                color: 'grey', // Color value
                value: 3,
                width: 2, // Width of the line
                label: {
                    text: 'Abstenciones',
                    align: 'left',
                    y: -20,
                    style: {
                        color: 'grey',
                        fontWeight: 'bold',
                    },
                },
            },
            {
                color: 'grey', // Color value
                value: 6,
                width: 2, // Width of the line
                label: {
                    text: 'No',
                    align: 'left',
                    y: -20,
                    style: {
                        color: 'grey',
                        fontWeight: 'bold',
                    },
                },
            },
            {
                color: 'grey', // Color value
                value: 9,
                width: 2, // Width of the line
                label: {
                    text: 'Si',
                    align: 'left',
                    y: -20,
                    style: {
                        color: 'grey',
                        fontWeight: 'bold',
                    },
                },
            }],
        },

        series: partidos,
    });
});
	</script>
    <script type="text/javascript" charset="UTF-8">
        $(function() {
            $("#busqueda").autocomplete({
                source: "/busqueda/autocompletar/",
                minLength: 2,
            });
        });
    </script>
    <div id="tabla" class="tabla"></div>
{% endblock %}